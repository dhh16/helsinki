# -*- coding: utf-8 -*-

import pysal
from shapely.geometry import Polygon, Point
import csv


'''
area_code_dict = {
    "Länsi-Pasila": 171,
    "Itä-Pasila": 173
}
'''


def select_by_location(input, output, polygon):
    n = 0
    fin = pysal.open(input)
    with open(output, 'w') as fout:
        writer = csv.writer(fout)

        for i in range(len(fin)):
            if i == 0:
                writer.writerow(fin[0])
            else:
                coord = fin[i][0][1]
                if coord != 'NA':
                    lat, lon = coord.split(',')
                    point = Point(float(lon), float(lat))
                    if polygon.contains(point):
                        n += 1
                        writer.writerow(fin[i])

    print(n)


def main():
    input = "records_with_coordinates.csv"
    results = "lpasila_records.csv"

    poly = Polygon([ [ 24.907539723370999, 60.208621839224897, 0.0 ], [ 24.910562516200098, 60.2128036601624, 0.0 ], [ 24.9131049569487, 60.211554719442098, 0.0 ], [ 24.913867110025102, 60.211191174750503, 0.0 ], [ 24.914044139716001, 60.211103393599302, 0.0 ], [ 24.914381200632899, 60.210881551493799, 0.0 ], [ 24.916520385109798, 60.209816414319803, 0.0 ], [ 24.9169669369853, 60.209594060042399, 0.0 ], [ 24.918199521381901, 60.208980271900501, 0.0 ], [ 24.919109014475101, 60.208527348008403, 0.0 ], [ 24.920315752302599, 60.207893033556999, 0.0 ], [ 24.920465977359701, 60.207822891273103, 0.0 ], [ 24.922747855902099, 60.206707198390397, 0.0 ], [ 24.9229243705046, 60.206611004081601, 0.0 ], [ 24.924782691893199, 60.205684194675101, 0.0 ], [ 24.925061279170801, 60.205521431003703, 0.0 ], [ 24.9253996834459, 60.2053131053963, 0.0 ], [ 24.926345759068699, 60.204568039087803, 0.0 ], [ 24.926405379134401, 60.204626484048497, 0.0 ], [ 24.926728813381501, 60.2044398761537, 0.0 ], [ 24.926384850047, 60.204062530625897, 0.0 ], [ 24.926266344485001, 60.203900575593899, 0.0 ], [ 24.925902336879101, 60.203320903223599, 0.0 ], [ 24.925809210116501, 60.203097713829003, 0.0 ], [ 24.925788901074402, 60.202948324934901, 0.0 ], [ 24.925777274433401, 60.202862809820203, 0.0 ], [ 24.927660218428599, 60.198972233427199, 0.0 ], [ 24.928477158119399, 60.197283954314898, 0.0 ], [ 24.929530593385, 60.195106680826598, 0.0 ], [ 24.9296494644021, 60.194854696537803, 0.0 ], [ 24.929862980291599, 60.194402099017303, 0.0 ], [ 24.929890537700899, 60.194333002942997, 0.0 ], [ 24.929911182727, 60.194259182144599, 0.0 ], [ 24.929924585857101, 60.194187242351497, 0.0 ], [ 24.929929681964701, 60.194134846607902, 0.0 ], [ 24.929930784773799, 60.194082610311398, 0.0 ], [ 24.929923405246999, 60.193988427446598, 0.0 ], [ 24.929908680171302, 60.193919470572901, 0.0 ], [ 24.9298904063861, 60.193857799853099, 0.0 ], [ 24.929869222031101, 60.193800040869597, 0.0 ], [ 24.929842422132602, 60.193742431493497, 0.0 ], [ 24.929823556819901, 60.193708853481198, 0.0 ], [ 24.9298090897972, 60.193683831359202, 0.0 ], [ 24.929786342030699, 60.193649219114299, 0.0 ], [ 24.929765114105699, 60.193620441686399, 0.0 ], [ 24.929734019954601, 60.193581696323299, 0.0 ], [ 24.929684134292199, 60.193525591523802, 0.0 ], [ 24.929643208283199, 60.193486185720602, 0.0 ], [ 24.9296248768796, 60.193468620092801, 0.0 ], [ 24.9291731549106, 60.193040073046902, 0.0 ], [ 24.929149403083901, 60.193016015235401, 0.0 ], [ 24.929128004873, 60.192991420152701, 0.0 ], [ 24.929109014255602, 60.192966332705801, 0.0 ], [ 24.9290841271071, 60.1929254543561, 0.0 ], [ 24.929065830437299, 60.192883717887298, 0.0 ], [ 24.929054240811301, 60.192841392626903, 0.0 ], [ 24.929049420733399, 60.192798738896798, 0.0 ], [ 24.929051405629298, 60.192756034954499, 0.0 ], [ 24.9290795750718, 60.192532885405598, 0.0 ], [ 24.929283668838501, 60.192225290370303, 0.0 ], [ 24.928419429112999, 60.192060298433802, 0.0 ], [ 24.926373454997901, 60.191634075862801, 0.0 ], [ 24.925769591917099, 60.191490491640003, 0.0 ], [ 24.925494686370801, 60.191426881307798, 0.0 ], [ 24.925320882096401, 60.191384832466497, 0.0 ], [ 24.925235075755602, 60.191363548291001, 0.0 ], [ 24.9251476940487, 60.191341500260698, 0.0 ], [ 24.9250252838333, 60.191309981263402, 0.0 ], [ 24.924969006391699, 60.191295247707501, 0.0 ], [ 24.924915503580301, 60.191281090125102, 0.0 ], [ 24.9248766917617, 60.191270728468403, 0.0 ], [ 24.9248709272049, 60.1912691814317, 0.0 ], [ 24.924860650109899, 60.1912664111818, 0.0 ], [ 24.924851336732299, 60.191263919714999, 0.0 ], [ 24.924815173311998, 60.1912541519184, 0.0 ], [ 24.924746719991301, 60.191235480133201, 0.0 ], [ 24.924615480540499, 60.191199001318097, 0.0 ], [ 24.924428618581199, 60.191145509205001, 0.0 ], [ 24.924409596706901, 60.191139960533697, 0.0 ], [ 24.924007988863401, 60.191840594078499, 0.0 ], [ 24.9236985990614, 60.192255466416803, 0.0 ], [ 24.923436830827001, 60.192606460582198, 0.0 ], [ 24.9234185291443, 60.192628071781101, 0.0 ], [ 24.923396516106099, 60.192648810218898, 0.0 ], [ 24.9233709633309, 60.192668514435297, 0.0 ], [ 24.9233420694571, 60.192687031961199, 0.0 ], [ 24.9233100420747, 60.192704237258702, 0.0 ], [ 24.922387522520001, 60.193158251297596, 0.0 ], [ 24.922229692756499, 60.193386995908703, 0.0 ], [ 24.9225734839561, 60.194267334743301, 0.0 ], [ 24.922508722811699, 60.194362678593301, 0.0 ], [ 24.917883144467702, 60.196570583104801, 0.0 ], [ 24.917706507862601, 60.197807778201401, 0.0 ], [ 24.917043065748601, 60.202453777908602, 0.0 ], [ 24.916435561753101, 60.202641054213402, 0.0 ], [ 24.916167735450799, 60.203208157310797, 0.0 ], [ 24.916161397088398, 60.2032223613596, 0.0 ], [ 24.916156787514598, 60.2032339187584, 0.0 ], [ 24.916153373327901, 60.203243403595799, 0.0 ], [ 24.9161470273195, 60.203264132753198, 0.0 ], [ 24.9161445590657, 60.203273905401097, 0.0 ], [ 24.916142415223302, 60.203283741081698, 0.0 ], [ 24.916139972586699, 60.203297606527002, 0.0 ], [ 24.916138344931799, 60.203310081300799, 0.0 ], [ 24.916136898791901, 60.203329153106701, 0.0 ], [ 24.916136657313402, 60.203346053627897, 0.0 ], [ 24.916136813247899, 60.203352076218302, 0.0 ], [ 24.916137959034099, 60.203369444337199, 0.0 ], [ 24.9161406920337, 60.203390188208999, 0.0 ], [ 24.916144083323498, 60.203407351313103, 0.0 ], [ 24.916148922545801, 60.203425942420701, 0.0 ], [ 24.9161572803247, 60.203450692874803, 0.0 ], [ 24.916166008921198, 60.203471458486099, 0.0 ], [ 24.916169856008999, 60.203479601603, 0.0 ], [ 24.916174825929701, 60.203489378951701, 0.0 ], [ 24.916177715316898, 60.203494774991398, 0.0 ], [ 24.9161864851093, 60.2035100028071, 0.0 ], [ 24.916191261997898, 60.203517697740899, 0.0 ], [ 24.916210646416801, 60.203545982488798, 0.0 ], [ 24.916218158390699, 60.203555949924798, 0.0 ], [ 24.916223667305601, 60.203562972165003, 0.0 ], [ 24.916226525333599, 60.203566528227398, 0.0 ], [ 24.9162409793949, 60.203583671388699, 0.0 ], [ 24.916252856008601, 60.203596836820097, 0.0 ], [ 24.9162724863934, 60.203617088733303, 0.0 ], [ 24.9163042826676, 60.203646691708897, 0.0 ], [ 24.9163338374901, 60.203671383720803, 0.0 ], [ 24.9163804793777, 60.203706076115601, 0.0 ], [ 24.916420929552601, 60.203732803415299, 0.0 ], [ 24.916468723725899, 60.203761168849802, 0.0 ], [ 24.916500749775398, 60.203778529480701, 0.0 ], [ 24.9165305636058, 60.2037936448625, 0.0 ], [ 24.916568052545799, 60.203811367930399, 0.0 ], [ 24.916594133764502, 60.2038229356682, 0.0 ], [ 24.916632483785001, 60.203838891105903, 0.0 ], [ 24.9166557041946, 60.203847988799403, 0.0 ], [ 24.916665819532898, 60.203851827649103, 0.0 ], [ 24.916677385301998, 60.203856125154402, 0.0 ], [ 24.916685231050199, 60.2038589932341, 0.0 ], [ 24.9166914014464, 60.203861214032599, 0.0 ], [ 24.916704985573801, 60.2038660064499, 0.0 ], [ 24.916781113451201, 60.203892531652897, 0.0 ], [ 24.9168392064568, 60.203937965643, 0.0 ], [ 24.916823948140099, 60.203942730987301, 0.0 ], [ 24.9168057576303, 60.203948266375001, 0.0 ], [ 24.916788677368402, 60.203953299834502, 0.0 ], [ 24.9167734019825, 60.203957679220203, 0.0 ], [ 24.916736626761299, 60.203967744487301, 0.0 ], [ 24.916699546380102, 60.203977253078001, 0.0 ], [ 24.9166673571739, 60.203985005553498, 0.0 ], [ 24.916636612489601, 60.203991987044702, 0.0 ], [ 24.916599617365701, 60.203999853163502, 0.0 ], [ 24.916505330658701, 60.204019557672098, 0.0 ], [ 24.916459827491, 60.204029689171598, 0.0 ], [ 24.916408126719698, 60.204041189985702, 0.0 ], [ 24.916380676242301, 60.204046827184101, 0.0 ], [ 24.916345853769901, 60.2040547394786, 0.0 ], [ 24.916321577270701, 60.204060253010802, 0.0 ], [ 24.9162595364274, 60.204074682198403, 0.0 ], [ 24.916203249409399, 60.204088495689703, 0.0 ], [ 24.916091100044799, 60.2041157100007, 0.0 ], [ 24.9159819327093, 60.204143760817701, 0.0 ], [ 24.9158154597982, 60.204188837417398, 0.0 ], [ 24.916425129787601, 60.204772058236898, 0.0 ], [ 24.9153552667164, 60.205049123482603, 0.0 ], [ 24.914534161433, 60.205641044874199, 0.0 ], [ 24.913630291764701, 60.2058750942129, 0.0 ], [ 24.909514203703399, 60.2083033446578, 0.0 ], [ 24.9085654441771, 60.2082038032569, 0.0 ], [ 24.907539723370999, 60.208621839224897, 0.0 ] ])
    select_by_location(input, results, poly)


if __name__ == '__main__':
    main()
